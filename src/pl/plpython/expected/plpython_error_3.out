-- test error handling, i forgot to restore Warn_restart in
-- the trigger handler once. the errors and subsequent core dump were
-- interesting.
SELECT invalid_type_uncaught('rick');
WARNING:  PL/Python: <class 'plpy.SPIError'>: unrecognized error in PLy_spi_prepare
CONTEXT:  PL/Python function "invalid_type_uncaught"
ERROR:  type "test" does not exist
CONTEXT:  PL/Python function "invalid_type_uncaught"
SELECT invalid_type_caught('rick');
WARNING:  PL/Python: <class 'plpy.SPIError'>: unrecognized error in PLy_spi_prepare
CONTEXT:  PL/Python function "invalid_type_caught"
ERROR:  type "test" does not exist
CONTEXT:  PL/Python function "invalid_type_caught"
SELECT invalid_type_reraised('rick');
WARNING:  PL/Python: <class 'plpy.SPIError'>: unrecognized error in PLy_spi_prepare
CONTEXT:  PL/Python function "invalid_type_reraised"
ERROR:  type "test" does not exist
CONTEXT:  PL/Python function "invalid_type_reraised"
SELECT valid_type('rick');
 valid_type 
------------
 
(1 row)

--
-- Test Unicode error handling.
--
SELECT unicode_return_error();
ERROR:  PL/Python: could not create string representation of Python object, while creating return value
DETAIL:  <type 'exceptions.UnicodeEncodeError'>: 'ascii' codec can't encode character u'\x80' in position 0: ordinal not in range(128)
CONTEXT:  PL/Python function "unicode_return_error"
INSERT INTO unicode_test (testvalue) VALUES ('test');
ERROR:  PL/Python: could not compute string representation of Python object, while modifying trigger row
DETAIL:  <type 'exceptions.UnicodeEncodeError'>: 'ascii' codec can't encode character u'\x80' in position 0: ordinal not in range(128)
CONTEXT:  PL/Python function "unicode_trigger_error"
SELECT unicode_plan_error1();
WARNING:  PL/Python: <class 'plpy.Error'>: unrecognized error in PLy_spi_execute_plan
CONTEXT:  PL/Python function "unicode_plan_error1"
ERROR:  PL/Python: could not execute plan
DETAIL:  <type 'exceptions.UnicodeEncodeError'>: 'ascii' codec can't encode character u'\x80' in position 0: ordinal not in range(128)
CONTEXT:  PL/Python function "unicode_plan_error1"
SELECT unicode_plan_error2();
ERROR:  PL/Python: could not execute plan
DETAIL:  <type 'exceptions.UnicodeEncodeError'>: 'ascii' codec can't encode character u'\x80' in position 0: ordinal not in range(128)
CONTEXT:  PL/Python function "unicode_plan_error2"
