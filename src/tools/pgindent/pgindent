#!/bin/sh

trap "rm -f /tmp/$$ /tmp/$$a" 0 1 2 3 15
entab </dev/null >/dev/null
if [ "$?" -ne 0 ]
then	echo "Go to the src/tools/entab directory and do a 'make' and 'make install'." >&2
	echo "This will put the 'entab' command in your path." >&2
	echo "Then run $0 again."
	exit 1
fi
indent --version </dev/null >/dev/null 2>&1
if [ "$?" -eq 0 ]
then	echo "You do not appear to have 'indent' installed on your system." >&2
	exit 1
fi
indent -version -npro </dev/null >/dev/null 2>&1
if [ "$?" -eq 0 ]
then	echo "You appear to have GNU indent rather than BSD indent." >&2
	echo "See the pgindent/README file for a description of its problems." >&2
	EXTRA_OPTS="-ncdb -bli0 -npcs -cli4"
else	echo "Hope you installed /src/tools/pgindent/indent.bsd.patch." >&2
	EXTRA_OPTS="-bbb -cli1"
fi

for FILE
do
	cat $FILE |
	sed 's;/\*  *---;/*---X_X;g' |
# workaround for indent bug with 'else' handling
	sed 's;\([} 	]\)else[ 	]*\(/\*.*\)$;\1else\
\2;g' | 
	detab -t4 -qc |
# protect backslashes in DATA()
	sed 's;^DATA(.*$;/*&*/;' >/tmp/$$a

# We get the list of typedef's from /src/tools/find_typedef
	indent -bad -bap -bc -bl -d0 -cdb -nce -nfc1 -di12 -i4 -l75 \
		-lp -nip -npro $EXTRA_OPTS \
A_Const \
A_Expr \
A_Indices \
AbsoluteTime \
Acl \
AclId \
AclIdType \
AclItem \
AclMode \
Agg \
AggInfo \
AggState \
AggStatePerAgg \
AggStatePerAggData \
Aggref \
AllocBlock \
AllocBlockData \
AllocChunk \
AllocChunkData \
AllocMode \
AllocPointer \
AllocSet \
AllocSetData \
AlterGroupStmt \
AlterTableStmt \
AlterUserStmt \
AnyInvalidation \
Append \
AppendState \
Array \
ArrayRef \
ArrayType \
Atom \
Attr \
AttrDefault \
AttrNumber \
AuthRequest \
AuthRequestPacket \
BOX \
BTItem \
BTItemData \
BTMetaPageData \
BTPageOpaque \
BTPageOpaqueData \
BTPageState \
BTScanList \
BTScanListData \
BTScanOpaque \
BTScanOpaqueData \
BTSpool \
BTStack \
BTStackData \
BUCKET_INDEX \
Backend \
BackendId \
BackendTag \
BitArray \
BitIndex \
Block \
BlockId \
BlockIdData \
BlockNumber \
BoolPtr \
Bucket \
BufFile \
BufFlags \
Buffer \
BufferBlock \
BufferDesc \
BufferLock \
BufferTag \
CATEGORY \
CCHashFunc \
CHUNK_INFO \
CIRCLE \
CPFunction \
CPPFunction \
CancelRequestPacket \
CandidateList \
CaseExpr \
CaseWhen \
Cash \
CatCTup \
CatCache \
CatalogInvalidationData \
ChangeACLStmt \
ChangeVarNodes_context \
CheckPoint \
Chromosome \
City \
ClientData \
ClosePortalStmt \
ClusterStmt \
CmdType \
Colormap \
ColumnDef \
CommandDest \
CommandId \
CommentStmt \
CommonScanState \
CommonState \
ConnStatusType \
Const \
ConstrCheck \
ConstrType \
Constraint \
ConstraintsSetStmt \
ControlFileData \
CopyStmt \
Cost \
CostSelector \
CreateGroupStmt \
CreatePLangStmt \
CreateSeqStmt \
CreateStmt \
CreateTrigStmt \
CreateUserStmt \
CreatedbStmt \
Cursor \
DBState \
DCHCacheEntry \
DCH_poz \
DIR \
DR_printtup \
DateADT \
Datum \
DatumPtr \
DatumTuple \
DefElem \
DeferredTriggerEvent \
DeferredTriggerEventData \
DeferredTriggerEventItem \
DeferredTriggerStatus \
DeferredTriggerStatusData \
DefineStmt \
DeleteStmt \
Depth \
DestReceiver \
Display \
Dl_info \
Dlelem \
Dllist \
Drawable \
DropGroupStmt \
DropPLangStmt \
DropStmt \
DropTrigStmt \
DropUserStmt \
DropdbStmt \
DynamicFileList \
ELEMENT \
EState \
Edge \
ErrorMessagePacket \
ExcContext \
ExcData \
ExcDetail \
ExcFrame \
ExcId \
ExcMessage \
ExcProc \
Exception \
ExecStatus \
ExecStatusType \
ExitStatus \
ExplainState \
ExplainStmt \
Expr \
ExprContext \
ExtendStmt \
FILE \
FUNMAP \
FetchStmt \
File \
FileName \
FixedItem \
FixedItemData \
FixedStack \
FixedStackData \
Fjoin \
FkConstraint \
FmgrCall \
FmgrInfo \
FmgrValues \
Font \
FormData_pg_aggregate \
FormData_pg_am \
FormData_pg_amop \
FormData_pg_amproc \
FormData_pg_attrdef \
FormData_pg_attribute \
FormData_pg_class \
FormData_pg_database \
FormData_pg_description \
FormData_pg_group \
FormData_pg_index \
FormData_pg_inherits \
FormData_pg_ipl \
FormData_pg_language \
FormData_pg_listener \
FormData_pg_log \
FormData_pg_opclass \
FormData_pg_operator \
FormData_pg_proc \
FormData_pg_relcheck \
FormData_pg_rewrite \
FormData_pg_sequence \
FormData_pg_shadow \
FormData_pg_statistic \
FormData_pg_trigger \
FormData_pg_type \
FormData_pg_variable \
Form_pg_aggregate \
Form_pg_am \
Form_pg_amop \
Form_pg_amproc \
Form_pg_attrdef \
Form_pg_attribute \
Form_pg_class \
Form_pg_database \
Form_pg_description \
Form_pg_group \
Form_pg_index \
Form_pg_inherits \
Form_pg_ipl \
Form_pg_language \
Form_pg_log \
Form_pg_opclass \
Form_pg_operator \
Form_pg_proc \
Form_pg_relcheck \
Form_pg_rewrite \
Form_pg_sequence \
Form_pg_shadow \
Form_pg_statistic \
Form_pg_trigger \
Form_pg_type \
Form_pg_variable \
FormatNode \
Func \
FuncCall \
FuncIndexInfo \
FuncIndexInfoPtr \
FuncInfo \
Function \
FunctionCache \
FunctionCachePtr \
GC \
GContext \
GISTENTRY \
GISTPageOpaque \
GISTPageOpaqueData \
GISTSTACK \
GISTSTATE \
GISTScanList \
GISTScanListData \
GISTScanOpaque \
GISTScanOpaqueData \
GIST_SPLITVEC \
Gene \
GlobalMemory \
GlobalMemoryData \
Group \
GroupBuffer \
GroupClause \
GroupState \
HASHACTION \
HASHCTL \
HHDR \
HISTORY_STATE \
HIST_ENTRY \
HTAB \
HandleRIRAttributeRule_context \
Hash \
HashItem \
HashItemData \
HashJoin \
HashJoinState \
HashJoinTable \
HashJoinTuple \
HashJoinTupleData \
HashMetaPage \
HashMetaPageData \
HashPageOpaque \
HashPageOpaqueData \
HashPath \
HashScanList \
HashScanListData \
HashScanOpaque \
HashScanOpaqueData \
HashState \
HashTableData \
HashtFunc \
HeapAccessStatistics \
HeapAccessStatisticsData \
HeapMemoryBlock \
HeapMemoryBlockData \
HeapScanDesc \
HeapScanDescData \
HeapTuple \
HeapTupleData \
HeapTupleHeader \
HeapTupleHeaderData \
INTRANGE \
IPCKey \
IdList \
Ident \
IncrementVarSublevelsUp_context \
IndDesc \
IndInfo \
Index \
IndexAttributeBitMap \
IndexAttributeBitMapData \
IndexElem \
IndexInfo \
IndexList \
IndexOptInfo \
IndexPath \
IndexScan \
IndexScanDesc \
IndexScanDescData \
IndexScanDescPtr \
IndexScanState \
IndexStmt \
IndexStrategy \
IndexStrategyData \
IndexTuple \
IndexTupleData \
IndirectBlock \
InhInfo \
InhPaths \
InsertIndexResult \
InsertIndexResultData \
InsertStmt \
IntArray \
Int_yy_size_t \
Int_yy_state_type \
Interval \
InvalidationEntry \
InvalidationEntryData \
InvalidationMessage \
InvalidationMessageData \
InvalidationUserData \
IpcMemoryId \
IpcMemoryKey \
IpcSemaphoreId \
IpcSemaphoreKey \
Item \
ItemId \
ItemIdData \
ItemIdFlags \
ItemLength \
ItemOffset \
ItemPointer \
ItemPointerData \
Iter \
Join \
JoinExpr \
JoinInfo \
JoinPath \
JoinState \
JunkFilter \
KEYMAP_ENTRY \
KEYMAP_ENTRY_ARRAY \
KeyCode \
KeySuffix \
KeySym \
KeyWord \
Keymap \
LINE \
LOCK \
LOCKMASK \
LOCKMETHOD \
LOCKMETHODCTL \
LOCKMETHODTABLE \
LOCKMODE \
LOCKTAG \
LSEG \
LargeObjectDesc \
List \
ListenStmt \
LoadStmt \
LocalInvalid \
LocationIndex \
LockInfo \
LockInfoData \
LockRelId \
LockStmt \
LogRelationContents \
LogRelationContentsData \
LogicalTape \
LogicalTapeSet \
LookupEnt \
MarkData \
Mask \
Material \
MaterialState \
MdfdVec \
MemoryContext \
MemoryContextData \
MemoryContextMethods \
MergeJoin \
MergeJoinState \
MergePath \
MsgType \
NUMCacheEntry \
NUMDesc \
NUMProc \
NUM_poz \
Name \
NameData \
NestLoop \
NestLoopState \
NestPath \
Node \
NodeTag \
Noname \
NotifyStmt \
Numeric \
NumericData \
NumericDigit \
NumericVar \
Offset \
OffsetNumber \
OffsetVarNodes_context \
Oid \
OpType \
Opaque \
OpaqueData \
Oper \
Operator \
OprInfo \
OrderedElem \
OrderedElemData \
OrderedSet \
OrderedSetData \
OverflowPageAddress \
PATH \
PGLZ_DecompState \
PGLZ_Header \
PGLZ_HistEntry \
PGLZ_Strategy \
PGconn \
PGnotify \
PGresult \
POLYGON \
PQArgBlock \
PQExpBuffer \
PQExpBufferData \
PQconninfoOption \
PQnoticeProcessor \
PQprintOpt \
PROC \
PROC_HDR \
PROC_QUEUE \
Packet \
PacketDoneProc \
PacketLen \
PacketState \
Page \
PageHeader \
PageHeaderData \
PageManagerMode \
PageOffset \
Param \
ParamExecData \
ParamListInfo \
ParamListInfoData \
ParamNo \
ParseState \
PasswordPacket \
PasswordPacketV0 \
Path \
PathKeyItem \
PathKeysComparison \
Pixmap \
Plan \
Point \
Pointer \
Pool \
Port \
Portal \
PortalBlock \
PortalBlockData \
PortalBuffer \
PortalD \
PortalEntry \
PortalHashEnt \
PortalHeapMemory \
PortalMemoryContext \
PortalVariableMemory \
PostgresPollingStatusType \
PredInfo \
Prefix_Status \
PrinttupAttrInfo \
PrivateMem \
ProcState \
ProcedureStmt \
ProcessingMode \
ProjectionInfo \
ProtocolVersion \
PsqlSettings \
Query \
QueryDesc \
RI_OpreqHashEntry \
RI_QueryHashEntry \
RI_QueryKey \
RTSTACK \
RTSTATE \
RTScanList \
RTScanListData \
RTreePageOpaque \
RTreePageOpaqueData \
RTreeScanOpaque \
RTreeScanOpaqueData \
RangeQueryClause \
RangeTblEntry \
RangeVar \
RawColumnDefault \
RecipeStmt \
RegProcedure \
ReindexStmt \
RelExpr \
RelIdCacheEnt \
RelNameCacheEnt \
RelOptInfo \
RelabelType \
Relation \
RelationBuildDescInfo \
RelationData \
RelationInfo \
RelationInvalidationData \
RelationList \
RelationPtr \
RelativeTime \
Relids \
RemoveAggrStmt \
RemoveFuncStmt \
RemoveOperStmt \
RemoveStmt \
RenameStmt \
ResTarget \
Resdom \
ResolveNew_context \
RestrictInfo \
Result \
ResultState \
RetrieveIndexResult \
RetrieveIndexResultData \
RewriteInfo \
RewriteRule \
RmgrData \
RmgrId \
RowMark \
RuleLock \
RuleStmt \
SEGMENT \
SEG_OFFSET \
SEMA \
SHMEM_OFFSET \
SHM_QUEUE \
SISeg \
SLock \
SPINLOCK \
SPITupleTable \
SPLITVEC \
Scan \
ScanDirection \
ScanFunc \
ScanKey \
ScanKeyData \
ScanKeyword \
Screen \
ScreenFormat \
SelectStmt \
Selectivity \
SeqScan \
SeqTable \
SeqTableData \
SharedInvalid \
SharedInvalidData \
ShmemIndexEnt \
SigHandler \
Size \
Snapshot \
SnapshotData \
SockAddr \
Sort \
SortClause \
SortGroupBy \
SortState \
SplitNumber \
StartupPacket \
StrategyEvaluation \
StrategyEvaluationData \
StrategyExpression \
StrategyExpressionData \
StrategyMap \
StrategyMapData \
StrategyNumber \
StrategyOperator \
StrategyOperatorData \
StrategyTerm \
StrategyTermData \
StrategyTransformMap \
StrategyTransformMapData \
Stream \
StreamPtr \
StringInfo \
StringInfoData \
SubLink \
SubLinkType \
SubPlan \
SystemPortAddress \
TXTRANGE \
TableID \
TableInfo \
TargetEntry \
Tcl_AppInitProc \
Tcl_AsyncHandler \
Tcl_AsyncProc \
Tcl_CallFrame \
Tcl_Channel \
Tcl_ChannelProc \
Tcl_ChannelType \
Tcl_CloseProc \
Tcl_CmdDeleteProc \
Tcl_CmdInfo \
Tcl_CmdProc \
Tcl_CmdTraceProc \
Tcl_Command \
Tcl_DString \
Tcl_DriverBlockModeProc \
Tcl_DriverCloseProc \
Tcl_DriverGetHandleProc \
Tcl_DriverGetOptionProc \
Tcl_DriverInputProc \
Tcl_DriverOutputProc \
Tcl_DriverSeekProc \
Tcl_DriverSetOptionProc \
Tcl_DriverWatchProc \
Tcl_DupInternalRepProc \
Tcl_EolTranslation \
Tcl_Event \
Tcl_EventCheckProc \
Tcl_EventDeleteProc \
Tcl_EventProc \
Tcl_EventSetupProc \
Tcl_ExitProc \
Tcl_FileFreeProc \
Tcl_FileProc \
Tcl_FreeInternalRepProc \
Tcl_FreeProc \
Tcl_HashEntry \
Tcl_HashSearch \
Tcl_HashTable \
Tcl_IdleProc \
Tcl_Interp \
Tcl_InterpDeleteProc \
Tcl_MathProc \
Tcl_Namespace \
Tcl_NamespaceDeleteProc \
Tcl_Obj \
Tcl_ObjCmdProc \
Tcl_ObjType \
Tcl_PackageInitProc \
Tcl_PathType \
Tcl_Pid \
Tcl_QueuePosition \
Tcl_RegExp \
Tcl_SetFromAnyProc \
Tcl_TcpAcceptProc \
Tcl_Time \
Tcl_TimerProc \
Tcl_TimerToken \
Tcl_Trace \
Tcl_UpdateStringProc \
Tcl_Value \
Tcl_ValueType \
Tcl_Var \
Tcl_VarTraceProc \
TempRelList \
TempTable \
TidPath \
TidScan \
TidScanState \
Time \
TimeADT \
TimeInterval \
TimeIntervalData \
TimeTzADT \
Timestamp \
Tk_3DBorder \
Tk_Anchor \
Tk_ArgvInfo \
Tk_BindingTable \
Tk_Canvas \
Tk_CanvasTextInfo \
Tk_ConfigSpec \
Tk_Cursor \
Tk_CustomOption \
Tk_ErrorHandler \
Tk_ErrorProc \
Tk_EventProc \
Tk_FakeWin \
Tk_Font \
Tk_FontMetrics \
Tk_GenericProc \
Tk_GeomLostSlaveProc \
Tk_GeomMgr \
Tk_GeomRequestProc \
Tk_GetSelProc \
Tk_Image \
Tk_ImageChangedProc \
Tk_ImageCreateProc \
Tk_ImageDeleteProc \
Tk_ImageDisplayProc \
Tk_ImageFileMatchProc \
Tk_ImageFileReadProc \
Tk_ImageFileWriteProc \
Tk_ImageFreeProc \
Tk_ImageGetProc \
Tk_ImageMaster \
Tk_ImageStringMatchProc \
Tk_ImageStringReadProc \
Tk_ImageStringWriteProc \
Tk_ImageType \
Tk_Item \
Tk_ItemAreaProc \
Tk_ItemConfigureProc \
Tk_ItemCoordProc \
Tk_ItemCreateProc \
Tk_ItemCursorProc \
Tk_ItemDCharsProc \
Tk_ItemDeleteProc \
Tk_ItemDisplayProc \
Tk_ItemIndexProc \
Tk_ItemInsertProc \
Tk_ItemPointProc \
Tk_ItemPostscriptProc \
Tk_ItemScaleProc \
Tk_ItemSelectionProc \
Tk_ItemTranslateProc \
Tk_ItemType \
Tk_Justify \
Tk_LostSelProc \
Tk_OptionParseProc \
Tk_OptionPrintProc \
Tk_PhotoHandle \
Tk_PhotoImageBlock \
Tk_PhotoImageFormat \
Tk_RestrictAction \
Tk_RestrictProc \
Tk_SelectionProc \
Tk_TextLayout \
Tk_Uid \
Tk_Window \
TransactionId \
TransactionState \
TransactionStateData \
TransactionStmt \
Trigger \
TriggerData \
TriggerDesc \
TriggerEvent \
TruncateStmt \
TupSortStatus \
TupleBlock \
TupleConstr \
TupleDesc \
TupleTable \
TupleTableData \
TupleTableSlot \
Tuplesortstate \
Type \
TypeBlock \
TypeCast \
TypeInfo \
TypeName \
UNDO_LIST \
Unique \
UniqueState \
UnlistenStmt \
UpdateStmt \
UserAuth \
VAttList \
VAttListData \
VFunction \
VPageDescr \
VPageDescrData \
VPageList \
VPageListData \
VRelList \
VRelListData \
VRelStats \
VTupleLink \
VTupleLinkData \
VTupleMove \
VTupleMoveData \
VacAttrStats \
VacuumStmt \
Value \
Var \
VariableCache \
VariableCacheData \
VariableRelationContents \
VariableRelationContentsData \
VariableResetStmt \
VariableSetStmt \
VariableShowStmt \
VariableSpace \
VersionStmt \
Vfd \
ViewStmt \
Visual \
VisualID \
Window \
XActivateDeactivateEvent \
XActivateEvent \
XAnyEvent \
XArc \
XButtonEvent \
XButtonPressedEvent \
XButtonReleasedEvent \
XChar2b \
XCharStruct \
XCirculateEvent \
XCirculateRequestEvent \
XClientMessageEvent \
XColor \
XColormapEvent \
XConfigureEvent \
XConfigureRequestEvent \
XConnectionWatchProc \
XCreateWindowEvent \
XCrossingEvent \
XDeactivateEvent \
XDestroyWindowEvent \
XEDataObject \
XEnterWindowEvent \
XErrorEvent \
XErrorHandler \
XEvent \
XExposeEvent \
XExtCodes \
XExtData \
XFocusChangeEvent \
XFocusInEvent \
XFocusOutEvent \
XFontProp \
XFontSet \
XFontSetExtents \
XFontStruct \
XGCValues \
XGraphicsExposeEvent \
XGravityEvent \
XHostAddress \
XIC \
XICCallback \
XICProc \
XID \
XIDLookupEnt \
XIDProc \
XIDTAG \
XIM \
XIMCallback \
XIMCaretDirection \
XIMCaretStyle \
XIMFeedback \
XIMHotKeyState \
XIMHotKeyTrigger \
XIMHotKeyTriggers \
XIMPreeditCaretCallbackStruct \
XIMPreeditDrawCallbackStruct \
XIMPreeditState \
XIMPreeditStateNotifyCallbackStruct \
XIMProc \
XIMResetState \
XIMStatusDataType \
XIMStatusDrawCallbackStruct \
XIMStringConversionCallbackStruct \
XIMStringConversionFeedback \
XIMStringConversionOperation \
XIMStringConversionPosition \
XIMStringConversionText \
XIMStringConversionType \
XIMStyle \
XIMStyles \
XIMText \
XIMValuesList \
XIOErrorHandler \
XImage \
XKeyEvent \
XKeyPressedEvent \
XKeyReleasedEvent \
XKeyboardControl \
XKeyboardState \
XKeymapEvent \
XLeaveWindowEvent \
XLgwrResult \
XLgwrRqst \
XLogCtlData \
XLogCtlInsert \
XLogCtlWrite \
XLogPageHeader \
XLogPageHeaderData \
XLogRecPtr \
XLogRecord \
XLogSubRecord \
XMapEvent \
XMapRequestEvent \
XMappingEvent \
XModifierKeymap \
XMotionEvent \
XNoExposeEvent \
XOC \
XOM \
XOMCharSetList \
XOMFontInfo \
XOMOrientation \
XOrientation \
XPixmapFormatValues \
XPoint \
XPointer \
XPointerMovedEvent \
XPropertyEvent \
XRectangle \
XReparentEvent \
XResizeRequestEvent \
XSegment \
XSelectionClearEvent \
XSelectionEvent \
XSelectionRequestEvent \
XSetWindowAttributes \
XTextItem \
XTextItem16 \
XTimeCoord \
XUnmapEvent \
XVaNestedList \
XVirtualEvent \
XVisibilityEvent \
XWindowAttributes \
XWindowChanges \
XidStatus \
XmbTextItem \
XwcTextItem \
YYSTYPE \
YY_BUFFER_STATE \
YY_CHAR \
_LIB_VERSION_TYPE \
_LockId_ \
_RuneEntry \
_RuneLocale \
_RuneRange \
_SPI_connection \
_SPI_plan \
_XPrivDisplay \
aclitem \
apply_RIR_view_context \
assoc_list \
attribute_used_context \
backslashResult \
bits16 \
bits32 \
bits8 \
bool \
bool16 \
bool32 \
bool8 \
bytea \
caddr_t \
cat_t \
cc_t \
char \
check_if_rte_used_context \
check_ungrouped_columns_context \
clock_t \
clockid_t \
cset \
daddr_t \
datetkn \
deparse_context \
dev_t \
dhalloc_ptr \
div_t \
double \
evalPlanQual \
execRowMark \
execution_state \
f_smgr \
fd_mask \
fd_set \
finalize_primnode_results \
fix_parsetree_attnums_context \
fixpt_t \
float \
float32 \
float32data \
float4 \
float64 \
float64data \
float8 \
fpos_t \
func_ptr \
gid_t \
hashnode \
hbaPort \
in_addr_t \
in_port_t \
inet \
inet_struct \
ino_t \
int \
int16 \
int16_t \
int16m_t \
int2 \
int2vector \
int32 \
int32_t \
int32m_t \
int4 \
int64 \
int64_t \
int64m_t \
int8 \
int8_t \
int8m_t \
jmp_buf \
join_references_context \
key_t \
ldiv_t \
lztext \
macaddr \
manufacturer \
mode_t \
modifyAggrefChangeVarnodes_context \
nlink_t \
off_t \
oidvector \
pg_pwd \
pgsql_thing_t \
pid_t \
pqbool \
pqsigfunc \
printQueryOpt \
printTableOpt \
promptStatus_t \
ptrdiff_t \
pull_var_clause_context \
qaddr_t \
quad_t \
rangeTableEntry_used_context \
regex_t \
register_t \
regmatch_t \
regoff_t \
regproc \
replace_vars_with_subplan_refs_context \
rune_t \
sa_family_t \
segsz_t \
sequence_magic \
sig_atomic_t \
sig_func \
sig_t \
sighandler_cxt \
sigjmp_buf \
sigset_t \
size_t \
slock_t \
smgrid \
socklen_t \
sop \
sopno \
speed_t \
ssize_t \
swblk_t \
tcflag_t \
tcp_seq \
text \
thisLockWasTriggered_context \
time_t \
u_char \
u_int \
u_int16_t \
u_int16m_t \
u_int32_t \
u_int32m_t \
u_int64_t \
u_int64m_t \
u_int8_t \
u_int8m_t \
u_long \
u_quad_t \
u_short \
uch \
uid_t \
uint \
uint16 \
uint32 \
uint8 \
ushort \
va_list \
vm_offset_t \
vm_size_t \
void \
wchar_t \
word16 \
word32 \
word8 \
yy_size_t \
yy_state_type \
/tmp/$$a >/tmp/$$ 2>&1
	if [ "$?" -ne 0 -o -s /tmp/$$ ]
	then	echo "$FILE"
		cat /tmp/$$
	fi
	cat /tmp/$$a |
	sed 's;^/\*\(DATA(.*\)\*/$;\1;' |
	sed 's;/\*---X_X;/* ---;g' |
# workaround indent bug
	sed 's;^static[ 	][ 	]*;static ;g' |
	sed 's;^}[ 	][ 	]*/\*;}   /*;' |
	sed 's;^#endif[ 	][ 	]*/\*;#endif   /*;' |
	detab -t8 -qc |
#	entab -t4 -qc |
# move trailing * in function return type
	sed 's;^\([A-Za-z_][^	]*\)[ 	][ 	]*\*$;\1 *;' |
# remove un-needed braces around single statements
	awk '
	{	
			line3 = $0;  
			if (skips > 0)
				skips--;
			if (line1 ~ "		*{$" &&
			    line2 ~ "		*[^;{}]*;$" &&
			    line3 ~ "		*}$")
			{
				print line2;
				line1 = "";
				line2 = "";
				line3 = "";
				skips = 3;
			}
			else
	 			if (skips == 0 && NR >= 3)
					print line1;
			line1 = line2;
			line2 = line3;
			line3 = "";
		}
		END {
			if (skips <= 1)
				print line1;
			if (skips <= 2)
				print line2;
	}' |
#  Move prototype names to the same line as return type.  Useful for ctags. 
#  Indent should do this, but it does not.  It formats prototypes just
#  like real functions.
	awk '	BEGIN	{paren_level = 0}  
	{
		if ($0 ~ /^[a-zA-Z_][a-zA-Z_0-9]*[^\(]*$/)
		{
			saved_len = 0;
			saved_lines[++saved_len] = $0;
			if ((getline saved_lines[++saved_len]) == 0)
				print saved_lines[1];
			else
			if (saved_lines[saved_len] !~ /^[a-zA-Z_][a-zA-Z_0-9]*\(/ ||
			    saved_lines[saved_len] ~  /^[a-zA-Z_][a-zA-Z_0-9]*\(.*\)$/ ||
			    saved_lines[saved_len] ~  /^[a-zA-Z_][a-zA-Z_0-9]*\(.*\);$/)
			{
				print saved_lines[1];
				print saved_lines[2];
			}
			else
			{
				while (1)
				{
					if ((getline saved_lines[++saved_len]) == 0)
						break;
					if (saved_lines[saved_len] ~ /^[^ 	]/ ||
					    saved_lines[saved_len] !~ /,$/)
						break;
				}
				for (i=1; i <= saved_len; i++)
				{
					if (i == 1 && saved_lines[saved_len] ~ /\);$/)
					{
						printf "%s", saved_lines[i];
						if (substr(saved_lines[i], length(saved_lines[i]),1) != "*")
							printf " ";
					}
					else	print saved_lines[i];
				}
			}
		}
		else	print $0;
	}' |
	cat >/tmp/$$ && cat /tmp/$$ >$FILE
done

# The 'for' loop makes these backup files useless so delete them
rm -f *a.BAK
